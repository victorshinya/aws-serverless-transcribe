# AWS Serverless MP3 Transcription

Serverless application that automatically transcribes MP3 files uploaded to S3 to Brazilian Portuguese using AWS Transcribe and saves results to DynamoDB. Built with AWS SAM (Serverless Application Model).

## Project Structure

```
aws-serverless-transcribe/
├── README.md              # Project documentation
├── template.yaml          # SAM template with all resources
├── lambda_function.py     # Lambda function code
└── deploy.sh              # SAM deployment script
```

## Prerequisites

Install AWS SAM CLI:
```bash
# macOS
brew install aws-sam-cli

# Or download from: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/install-sam-cli.html
```

## Architecture

- **S3 Bucket**: Receives MP3 file uploads and triggers Lambda function
- **Lambda Function**: Processes files using AWS Transcribe service
- **AWS Transcribe**: Converts speech to text in Brazilian Portuguese (pt-BR)
- **DynamoDB**: Stores transcription results with metadata
- **CloudWatch**: Logs function execution and errors

## Deployment

### Using SAM (Recommended)

```bash
# Build and deploy with guided setup
sam build
sam deploy --guided

# Or use the deployment script
./deploy.sh
```

### Manual SAM Deployment

```bash
sam build
sam deploy \
    --stack-name transcribe-mp3-stack \
    --capabilities CAPABILITY_IAM \
    --region sa-east-1 \
    --profile your-aws-profile
```

## Usage

### Automatic Processing (Recommended)

Upload MP3 files to the S3 bucket and they will be automatically processed:

```bash
# Get the bucket name from stack outputs
BUCKET_NAME=$(aws cloudformation describe-stacks \
    --stack-name transcribe-mp3-stack \
    --query 'Stacks[0].Outputs[?OutputKey==`BucketName`].OutputValue' \
    --output text)

# Upload MP3 file
aws s3 cp your-audio.mp3 s3://$BUCKET_NAME/
```

### Manual Lambda Invocation

```bash
aws lambda invoke \
    --function-name transcribe-mp3-function \
    --payload '{"bucket":"your-bucket-name","key":"path/to/file.mp3"}' \
    response.json
```

### Local Testing

```bash
# Test function locally
sam local invoke TranscribeMp3Function -e events/s3-event.json

# Start local API
sam local start-api
```

## Resources Created

- **S3 Bucket**: `{stack-name}-mp3-uploads` - MP3 file storage with automatic Lambda trigger
- **Lambda Function**: `transcribe-mp3-function` - Main processing logic with auto-generated IAM role
- **DynamoDB Table**: `transcriptions` - Stores transcription results and metadata
- **IAM Role**: Auto-generated by SAM with minimal required permissions
- **CloudWatch Logs**: Automatic logging for debugging and monitoring

## Features

- **Automatic Triggering**: S3 upload automatically starts transcription
- **Error Handling**: Exponential backoff for API rate limiting
- **Comprehensive Logging**: Detailed CloudWatch logs for debugging
- **Secure**: Restricted IAM permissions and S3 bucket access
- **Scalable**: Serverless architecture handles concurrent uploads
- **Cost-Effective**: Pay-per-use pricing model

## Output Format

Transcription results are saved to DynamoDB with the following structure:

```json
{
  "id": "unique-uuid",
  "source_bucket": "bucket-name",
  "source_key": "path/to/file.mp3",
  "transcript": "Transcribed text in Portuguese",
  "timestamp": "2025-09-26T14:30:00.000Z",
  "language": "pt-BR"
}
```

## Monitoring

- **CloudWatch Logs**: `/aws/lambda/transcribe-mp3-function`
- **CloudWatch Metrics**: Lambda duration, errors, invocations
- **DynamoDB Metrics**: Item count, read/write capacity

## Troubleshooting

Common issues and solutions:

1. **No logs in CloudWatch**: Check S3 bucket notification configuration
2. **Access Denied errors**: Verify IAM permissions and bucket policies
3. **Transcription timeouts**: Check file size and format (MP3 only)
4. **Rate limiting**: Function includes exponential backoff for AWS Transcribe API

## Cleanup

Delete all resources:
```bash
sam delete --stack-name transcribe-mp3-stack
```

## Development

To modify the Lambda function:
1. Edit `lambda_function.py`
2. Run `sam build`
3. Deploy with `sam deploy`

The SAM template automatically packages and deploys your code changes.
